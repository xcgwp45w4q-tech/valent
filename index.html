<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Valentine ðŸ’–</title>

<style>
body {
  margin: 0;
  overflow: hidden;
  font-family: Arial, sans-serif;
}

/* ---------------- COUNTDOWN ---------------- */
#countdownScreen {
  position: fixed;
  inset: 0;
  background: #000;
  color: white;
  display: grid;
  place-items: center;
  z-index: 99999;
}

#countdownNum {
  font-size: clamp(80px, 18vw, 160px);
  font-weight: bold;
}

/* ---------------- MAIN SCENE ---------------- */
#scene {
  position: fixed;
  inset: 0;
  background: #ffe6f0;
  display: none;
}

/* Wrapper moves, video itself NEVER transforms */
#walker {
  position: absolute;
  bottom: 4vh;
  left: 110vw; /* start off-screen right */
  width: min(340px, 70vw);
  animation: walkIn 4s linear forwards;
  z-index: 5;
}

@keyframes walkIn {
  to { left: calc(50vw - min(340px, 70vw)/2); }
}

#video {
  width: 100%;
  height: auto;
  display: block;

  /* force no rotation */
  transform: none !important;
  rotate: 0deg !important;
  -webkit-transform: none !important;
  backface-visibility: hidden;
}

/* ---------------- QUESTION ---------------- */
#question {
  position: absolute;
  top: 12vh;
  width: 100%;
  text-align: center;
  font-size: clamp(24px, 5vw, 44px);
  opacity: 0;
  animation: fadeIn 0.9s forwards;
  animation-delay: 4s;
}

@keyframes fadeIn { to { opacity: 1; } }

.btn-row {
  margin-top: 16px;
  display: flex;
  justify-content: center;
  gap: 12px;
}

button {
  padding: 12px 22px;
  font-size: 18px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
}

#yes { background: #ff4d88; color: white; }
#no  { background: #d9d9d9; position: relative; z-index: 9999; }

/* ---------------- CONFETTI ---------------- */
#confetti {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 99998;
  display: none;
}
</style>
</head>

<body>

<!-- Countdown -->
<div id="countdownScreen">
  <div id="countdownNum">5</div>
</div>

<!-- Main Scene -->
<div id="scene">
  <div id="walker">
    <video id="video" src="walk.mp4" autoplay muted playsinline></video>
  </div>

  <div id="question">
    Will you be my Valentine? ðŸ’–
    <div class="btn-row">
      <button id="yes">YES ðŸ’˜</button>
      <button id="no">No ðŸ™ˆ</button>
    </div>
  </div>
</div>

<canvas id="confetti"></canvas>
<audio id="popSound" src="pop.mp3" preload="auto"></audio>

<script>
/* ---------------- COUNTDOWN LOGIC ---------------- */
const countdownScreen = document.getElementById("countdownScreen");
const countdownNum = document.getElementById("countdownNum");
const scene = document.getElementById("scene");

let n = 5;
const timer = setInterval(() => {
  n--;
  countdownNum.textContent = n;
  if (n <= 1) {
    clearInterval(timer);
    setTimeout(() => {
      countdownScreen.style.display = "none";
      scene.style.display = "block";
    }, 700);
  }
}, 1000);

/* ---------------- RUNAWAY BUTTON ---------------- */
const noBtn = document.getElementById("no");

function moveButton() {
  const pad = 10;
  noBtn.style.position = "fixed";
  const maxX = window.innerWidth - noBtn.offsetWidth - pad;
  const maxY = window.innerHeight - noBtn.offsetHeight - pad;
  noBtn.style.left = Math.random() * maxX + "px";
  noBtn.style.top  = Math.random() * maxY + "px";
}

noBtn.addEventListener("mouseenter", moveButton);
noBtn.addEventListener("touchstart", (e) => { e.preventDefault(); moveButton(); }, { passive: false });

/* ---------------- CONFETTI ---------------- */
const yesBtn = document.getElementById("yes");
const canvas = document.getElementById("confetti");
const ctx = canvas.getContext("2d");
const popSound = document.getElementById("popSound");

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

function confettiBurst() {
  canvas.style.display = "block";
  const pieces = [];
  const colors = ["#ff4d88","#ffd166","#06d6a0","#118ab2","#8338ec","#ffffff"];

  for (let i = 0; i < 180; i++) {
    pieces.push({
      x: Math.random() * canvas.width,
      y: -10,
      r: 3 + Math.random() * 5,
      vx: -2 + Math.random() * 4,
      vy: 2 + Math.random() * 5,
      color: colors[Math.floor(Math.random() * colors.length)]
    });
  }

  let start = performance.now();
  function frame(t) {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for (let p of pieces) {
      p.x += p.vx;
      p.y += p.vy;
      p.vy += 0.05;
      ctx.fillStyle = p.color;
      ctx.fillRect(p.x,p.y,p.r,p.r);
    }
    if (t - start < 2000) requestAnimationFrame(frame);
    else canvas.style.display = "none";
  }
  requestAnimationFrame(frame);
}

yesBtn.addEventListener("click", async () => {
  try { await popSound.play(); } catch(e){}
  confettiBurst();
});
</script>

</body>
</html>
