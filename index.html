<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Valentine ðŸ’–</title>

<style>
  body {
    margin: 0;
    overflow: hidden;
    font-family: Arial, sans-serif;
  }

  /* --- Countdown screen --- */
  #countdownScreen {
    position: fixed;
    inset: 0;
    background: #000;
    color: #fff;
    display: grid;
    place-items: center;
    z-index: 99999;
  }
  #countdownNum {
    font-size: clamp(72px, 18vw, 160px);
    font-weight: 800;
    letter-spacing: 2px;
  }

  /* --- Main scene --- */
  #scene {
    position: fixed;
    inset: 0;
    background: #ffe6f0;
    display: none; /* shown after countdown */
  }

  /* Video near bottom, entering from RIGHT to center-ish */
  #video {
    position: absolute;
    bottom: 4vh;
    width: min(340px, 70vw);
    height: auto;

    /* start off-screen to the right */
    left: 110vw;

    /* move in after scene starts */
    animation: walkIn 4s forwards linear;
  }

  @keyframes walkIn {
    to { left: 50%; transform: translateX(-50%) scaleX(-1); }
  }

  /* We set scaleX(-1) in keyframes end-state to flip direction.
     If your MP4 already faces correct way, remove scaleX(-1). */

  #question {
    position: absolute;
    top: 12vh;
    width: 100%;
    text-align: center;
    font-size: clamp(24px, 5vw, 44px);
    opacity: 0;
    animation: fadeIn 0.9s forwards;
    animation-delay: 4s;
    padding: 0 16px;
    box-sizing: border-box;
  }

  @keyframes fadeIn { to { opacity: 1; } }

  .btn-row {
    margin-top: 16px;
    display: flex;
    gap: 12px;
    justify-content: center;
    flex-wrap: wrap;
  }

  button {
    padding: 12px 22px;
    font-size: 18px;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
  }

  #yes { background: #ff4d88; color: white; }
  #no  { background: #d9d9d9; position: relative; z-index: 9999; }

  /* Confetti canvas on top */
  #confetti {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 99998;
    display: none;
  }
</style>
</head>

<body>

<!-- Countdown -->
<div id="countdownScreen">
  <div id="countdownNum">5</div>
</div>

<!-- Main Scene -->
<div id="scene">
  <video id="video" src="walk.mp4" autoplay muted playsinline></video>

  <div id="question">
    Will you be my Valentine? ðŸ’–
    <div class="btn-row">
      <button id="yes">YES ðŸ’˜</button>
      <button id="no">No ðŸ™ˆ</button>
    </div>
  </div>
</div>

<canvas id="confetti"></canvas>

<!-- Sound (add pop.mp3 in repo root) -->
<audio id="popSound" src="pop.mp3" preload="auto"></audio>

<script>
  // ---------- Countdown ----------
  const countdownScreen = document.getElementById("countdownScreen");
  const countdownNum = document.getElementById("countdownNum");
  const scene = document.getElementById("scene");

  let n = 5;
  const timer = setInterval(() => {
    n -= 1;
    countdownNum.textContent = String(n);

    if (n <= 1) {
      // show "1" briefly, then start
      clearInterval(timer);
      setTimeout(() => {
        countdownScreen.style.display = "none";
        scene.style.display = "block";
      }, 700);
    }
  }, 1000);

  // ---------- Runaway NO button (never disappears off-screen) ----------
  const noBtn = document.getElementById("no");

  function moveButton() {
    const padding = 12;
    noBtn.style.position = "fixed";
    noBtn.style.zIndex = 99999;

    const maxX = Math.max(padding, window.innerWidth  - noBtn.offsetWidth  - padding);
    const maxY = Math.max(padding, window.innerHeight - noBtn.offsetHeight - padding);

    const x = Math.floor(padding + Math.random() * (maxX - padding));
    const y = Math.floor(padding + Math.random() * (maxY - padding));

    noBtn.style.left = x + "px";
    noBtn.style.top  = y + "px";
  }

  noBtn.addEventListener("mouseenter", moveButton);
  noBtn.addEventListener("touchstart", (e) => { e.preventDefault(); moveButton(); }, { passive: false });
  noBtn.addEventListener("click", (e) => { e.preventDefault(); moveButton(); });

  // ---------- Confetti (simple, no library) ----------
  const yesBtn = document.getElementById("yes");
  const canvas = document.getElementById("confetti");
  const ctx = canvas.getContext("2d");
  const popSound = document.getElementById("popSound");

  function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  window.addEventListener("resize", resizeCanvas);
  resizeCanvas();

  function launchConfetti(durationMs = 2200) {
    canvas.style.display = "block";

    const pieces = [];
    const colors = ["#ff4d88", "#ffd166", "#06d6a0", "#118ab2", "#8338ec", "#ffffff"];
    const count = 180;

    for (let i = 0; i < count; i++) {
      pieces.push({
        x: Math.random() * canvas.width,
        y: -20 - Math.random() * canvas.height * 0.3,
        r: 3 + Math.random() * 5,
        vx: -2 + Math.random() * 4,
        vy: 3 + Math.random() * 6,
        rot: Math.random() * Math.PI,
        vr: -0.2 + Math.random() * 0.4,
        color: colors[Math.floor(Math.random() * colors.length)]
      });
    }

    const start = performance.now();
    function frame(t) {
      const elapsed = t - start;
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      for (const p of pieces) {
        p.x += p.vx;
        p.y += p.vy;
        p.vy += 0.05;      // gravity
        p.rot += p.vr;

        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.rotate(p.rot);
        ctx.fillStyle = p.color;
        ctx.fillRect(-p.r, -p.r, p.r * 2, p.r * 2);
        ctx.restore();
      }

      if (elapsed < durationMs) requestAnimationFrame(frame);
      else {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        canvas.style.display = "none";
      }
    }
    requestAnimationFrame(frame);
  }

  // ---------- YES handler: confetti + sound ----------
  yesBtn.addEventListener("click", async () => {
    // Audio on iPhone only plays after a user gesture -> this click qualifies
    try {
      popSound.currentTime = 0;
      await popSound.play();
    } catch (e) {
      // If you didn't add pop.mp3, sound will fail silently
    }
    launchConfetti();
  });
</script>

</body>
</html>
